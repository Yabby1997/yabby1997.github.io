---
layout: post
title: "ğŸ§‘â€ğŸ’» ëª¨ê°ì½” 9ì£¼ì°¨"
description: "2020ë…„ ê²¨ìš¸ë°©í•™, ëª¨ì—¬ì„œ ê°ì ì½”ë”©í•˜ì!"
date: 2020-02-14
feature_image: images/thumbnail_mogakko_9.png
tags: [ëª¨ê°ì½”, CNU, Tensorflow, Keras, Python]
---

ì´ì „ ê¸€ [ğŸ§‘â€ğŸ’» ëª¨ê°ì½” 8ì£¼ì°¨](https://yabby1997.github.io/mogakko_8) ë³´ëŸ¬ê°€ê¸°.

# ğŸ‘€ ì˜¤ëŠ˜ì˜ í•  ì¼
- ğŸ§‘â€ğŸ’» MNIST Classification ì‹¤ìŠµ

# ğŸ§‘â€ğŸ’» MNIST Classification ì‹¤ìŠµ
íŠ¹ê°• ì‹¤ìŠµì—ì„œ Fashion MNISTë¥¼ ì´ìš©í•œ Classificationì€ ì§ì ‘ ì‹¤ìŠµí–ˆìœ¼ë‚˜, ì „í†µì ì¸ MNISTì— ëŒ€í•œ ì‹¤ìŠµì€ í•˜ì§€ ì•Šì•˜ì—ˆë‹¤. ì˜¤ëŠ˜ì€ ê°€ë³ê²Œ Fashion MNIST ì‹¤ìŠµì„ ì°¸ê³ í•˜ì—¬ MNIST Classificationì„ êµ¬í˜„í•´ë³´ë ¤ê³  í•œë‹¤. 

## Import
í…ì„œí”Œë¡œìš° 2.0, keras, numpy, matplotlib, collectionsë¥¼ ì‚¬ìš©í•œë‹¤.
```python
try:
  # Colab only
  %tensorflow_version 2.x
except Exception:
  pass

import tensorflow as tf
from tensorflow import keras

import numpy as np
import matplotlib.pyplot as plt
import collections as col
```
colabì€ ê¸°ë³¸ì ìœ¼ë¡œ tensorflow 1ë²„ì „ì„ ì‚¬ìš©í•œë‹¤. ìœ„ì˜ ì½”ë“œëŠ” 2ë²„ì „ì„ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí•œë‹¤. colabì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. 

## Dataset ê°€ì ¸ì˜¤ê¸°
kerasì—ì„œëŠ” MNIST ë°ì´í„°ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•œë‹¤. ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ í›ˆë ¨ì…‹ê³¼ í…ŒìŠ¤íŠ¸ì…‹ì„ ì†ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
```python
mnist = keras.datasets.mnist
(train_images, train_labels), (test_images, test_labels) = mnist.load_data()

print(train_images.shape)
print(train_labels.shape)
print(test_images.shape)
print(test_labels.shape)
```
{% include image_caption.html imageurl="/images/mogakko_9_1.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}

## Label ë³„ ê°œìˆ˜ í™•ì¸
collectionsì˜ Counterí•¨ìˆ˜ë¥¼ í†µí•´ labelë³„ë¡œ ëª‡ê°œì”© ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤. Fashion MNISTì™€ëŠ” ë‹¬ë¦¬ ê³ ë¥´ê²Œ ë¶„í¬ë˜ì–´ìˆì§€ ì•Šë‹¤. ë³´ê¸°ì¢‹ê²Œ matplotlibì˜ histogramì„ í†µí•´ ì‹œê°í™” í•´ ë³´ì•˜ë‹¤. 
```python
col.Counter(train_labels)
col.Counter(test_labels)
plt.hist(train_labels, color = 'green', alpha = .5)
plt.hist(test_labels, color = 'green', alpha = .5)
```
{% include image_caption.html imageurl="/images/mogakko_9_2.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
{% include image_caption.html imageurl="/images/mogakko_9_3.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}

## ì´ë¯¸ì§€ í™•ì¸
í›ˆë ¨ ì´ë¯¸ì§€ ì…‹ì—ì„œ ì²«ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ì‹œê°í™”í•˜ì—¬ í™•ì¸í•´ë³´ì•˜ë‹¤.
```python
plt.figure(figsize = (10, 10))        # ì „ì²´ í”¼ê²¨ ì‚¬ì´ì¦ˆë¥¼ 10*10ìœ¼ë¡œ
for i in range(25) :
  plt.subplot(5, 5, i + 1)
  plt.xticks([])                      # x ëˆˆê¸ˆ ì œê±°
  plt.yticks([])                      # y ëˆˆê¸ˆ ì œê±°
  plt.xlabel(train_labels[i])         # x ì¶• ë¼ë²¨ì— ì •ë‹µ
  plt.imshow(train_images[i])
```
{% include image_caption.html imageurl="/images/mogakko_9_4.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}

## ì´ë¯¸ì§€ ë¶„ì„, ì •ê·œí™”
ì´ë¯¸ì§€ëŠ” 255ê¹Œì§€ì˜ ê°•ë„ë¥¼ ê°–ëŠ” í”½ì…€ 24*24ê°œë¡œ ì´ë£¨ì–´ ì ¸ ìˆë‹¤. ë”°ë¼ì„œ 255ë¡œ ë‚˜ëˆ ì¤Œìœ¼ë¡œ ì¨ ì´ë¯¸ì§€ì˜ ëª¨ë“  í”½ì…€ì„ 0~1ì‚¬ì´ì˜ ìˆ˜ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤. (ì •ê·œí™”) 255ë¡œ ë‚˜ëˆˆ ë’¤, Counterì™€ figureë¥¼ í†µí•´ ì •ê·œí™”ê°€ ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 
```python
col.Counter(train_images[0].reshape(784))    # 0 ë²ˆì§¸ ì´ë¯¸ì§€(24*24 2ì°¨ì› ë°°ì—´)ë¥¼ 784ì‚¬ì´ì¦ˆì˜ 1ì°¨ì› ë°°ì—´ë¡œ reshapeí•˜ì—¬ ìš”ì†Œ(ìƒ‰ì„ ê²°ì •í•˜ëŠ” ìˆ˜ì¹˜)ë¥¼ í™•ì¸í•´ ë³´ì•˜ë‹¤.
```
{% include image_caption.html imageurl="/images/mogakko_9_5.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
0~255ì˜ ê°’ì„ ê°–ëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```python
train_images = train_images / 255.0
test_images = test_images / 255.0

col.Counter(train_images[0].reshape(784))
```
{% include image_caption.html imageurl="/images/mogakko_9_6.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
255.0ìœ¼ë¡œ ë‚˜ëˆ„ì–´ 0~1.0ì‚¬ì´ì˜ ê°’ì„ ê°–ê²Œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```python
plt.figure(figsize = (10, 10))
plt.imshow(train_images[0])
plt.colorbar()
plt.show()
```
{% include image_caption.html imageurl="/images/mogakko_9_7.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
`figure()`ë¥¼ í†µí•´ ê·¸ë¦¼ì„ ê·¸ë ¤ë³´ì•„ì„œë„ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤. 
## í•™ìŠµ ëª¨ë¸
kerasë¥¼ ì´ìš©í•˜ë©´ ê°„ë‹¨í•˜ê²Œ ëª¨ë¸ì„ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆë‹¤.
costí•¨ìˆ˜ë¡œ sparse categorical crossentropyë¥¼ ì‚¬ìš©í•œë‹¤. crossentropyëŠ” ë‹¨ìˆœíˆ ë§ì•˜ëƒ í‹€ë¦¬ëƒë¡œë§Œ costë¥¼ ê³„ì‚°í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ì–¼ë§ˆì˜ ì°¨ì´ë¡œ ì¸í•´ í‹€ë ¸ëŠ”ì§€ ê¹Œì§€ ê³„ì‚°ì— í¬í•¨í•œë‹¤. ë”°ë¼ì„œ ë¶„ë¥˜ë¬¸ì œì—ì„œ ë” ë‚˜ì€ costë¥¼ ê³„ì‚°í•´ë‚¸ë‹¤. ê´€ë ¨ ë‚´ìš©ì€ [ì—¬ê¸°](http://funmv2013.blogspot.com/2017/01/cross-entropy.html)ì—ì„œ ì°¸ì¡°í–ˆë‹¤. crossentropyì¤‘ì—ì„œë„ [sparseë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ](https://stats.stackexchange.com/questions/326065/cross-entropy-vs-sparse-cross-entropy-when-to-use-one-over-the-other)ëŠ” [one-hot encoding](https://wikidocs.net/22647)ë˜ì–´ìˆëŠ” ìë£Œê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì´ë‹¤. OptimizerëŠ” [Adam optimizer](http://mjgim.me/2018/01/22/adam.html)ë¥¼ ì‚¬ìš©í•œë‹¤. ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—ì„œ ê°€ì¥ ì˜ ì‘ë™í•˜ëŠ” Optimizerë¡œ, Optimizerì˜ ëíŒì™•(..)ì´ë¼ëŠ” ë§ë„ ìˆë‹¤. ì‚¬ì‹¤ ì•„ì§ ê¹Šê²Œ ê³µë¶€í•´ë³´ì§€ ì•Šì•„ì„œ ë¬´ìŠ¨ ì°¨ì´ê°€ ìˆëŠ”ì§€ëŠ” ëª¨ë¥¸ë‹¤. ì°¨í›„ì— ê³µë¶€í•´ì•¼ê² ë‹¤.
```python
model = keras.Sequential()
model.add(keras.layers.Flatten(input_shape = (28, 28)))
model.add(keras.layers.Dense(128, activation = 'relu'))
model.add(keras.layers.Dense(10, activation = 'softmax'))

model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])

model.fit(train_images, train_labels, epochs=10)
```
{% include image_caption.html imageurl="/images/mogakko_9_8.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
í›ˆë ¨ ì…‹ì— ëŒ€í•´ì„œ 99%ê¹Œì§€ì˜ ì •í™•ë„ê°€ ë‚˜ì˜¬ ì •ë„ë¡œ í•™ìŠµì´ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
## ê²€ì¦
í•™ìŠµê²°ê³¼ë¥¼ ê²€ì¦. `model.evaluate()`ë¥¼ í†µí•´ì„œ í•™ìŠµëœ ëª¨ë¸ì„ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.
```python
loss, accuracy = model.evaluate(test_images,  test_labels, verbose = 1)
print('\ntest loss\t: ', loss)
print('test accuracy\t: ', accuracy)
```
{% include image_caption.html imageurl="/images/mogakko_9_9.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
í…ŒìŠ¤íŠ¸ ì…‹ì— ëŒ€í•´ì„œëŠ” ì •í™•ë„ê°€ 97%ê°€ëŸ‰ì´ ë‚˜ì˜´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì•„ë¬´ë ˆë„ í›ˆë ¨ ì…‹ì— ëŒ€í•œ overfittingì´ ì•½ê°„ ìˆëŠ”ê²ƒìœ¼ë¡œ ì¶”ì •ëœë‹¤. 
```python
predictions = model.predict(test_images)
plt.figure(figsize=(20,20))
for i in range(25) :
  plt.subplot(5, 5, i+1)
  plt.imshow(test_images[i])
  plt.xticks([])
  plt.yticks([])
  description = str(np.argmax(predictions[i])) + " / " + str(test_labels[i])
  plt.xlabel(description)
plt.show()
```
{% include image_caption.html imageurl="/images/mogakko_9_10.png" title="" caption="ìˆ˜í–‰ê²°ê³¼" %}
í…ŒìŠ¤íŠ¸ ì…‹ ì´ˆê¸° 25ê°œì˜ ì´ë¯¸ì§€ì— ëŒ€í•´ ì´ë¯¸ì§€ì™€ ì˜ˆì¸¡ê°’, ì •ë‹µì„ í•¨ê»˜ ë³´ì—¬ì£¼ë„ë¡ ì¶œë ¥í•´ë³´ì•˜ë‹¤. 


ì´ì „ì— Fashion MNISTë¥¼ í†µí•´ ì‹¤ìŠµí•´ë³¸ ê²½í—˜ìœ¼ë¡œ ì¸í•´ ì´ë²ˆ ì‹¤ìŠµì€ ì–´ë µì§€ì•Šê²Œ ì§„í–‰í•  ìˆ˜ ìˆì—ˆë‹¤. ë˜ ì €ë²ˆì— ë„ì „í–ˆë˜ Bank marketing dataset ì‹¤ìŠµê³¼ ë‹¬ë¦¬ ì´ë²ˆ MNIST classificationì—ì„œëŠ” ì˜¤ì§ Kerasë¥¼ ì‚¬ìš©í•´ ëª¨ë¸ì„ ë§Œë“¤ì—ˆëŠ”ë°, ê·¸ ê³¼ì •ì´ ë§¤ìš° ê°„ë‹¨í•˜ê³  ì§ê´€ì ì´ì–´ì„œ ì´ì œëŠ” ì •ë§ ë”¥ëŸ¬ë‹ì´ ë§ì´ ëŒ€ì¤‘í™”ê°€ ë˜ì—ˆìŒì„ ëŠê¼ˆë‹¤. 
